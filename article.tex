%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[a4paper]{llncs}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage[all]{xy}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{complexity}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\DeclareMathOperator{\RUN}{run}
\DeclareMathOperator{\RED}{red}
\DeclareMathOperator{\AV}{Av}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% 231,213
\newcommand{\myPattern}{231,231}

% avoid set
\DeclareMathOperator{\Avd}{Av}
\newcommand\Av[2]{\Avd_{{#1}}({#2})}

% le set de toutes les permitaton
\newcommand{\Perm}[1]{\mathcal{S}_{#1}}

% permutation text
\newcommand{\ptext}{\pi}

% permutation motif
\newcommand{\pmotif}{\sigma}

\newcommand\BV[2]{\genfrac{}{}{0pt}{}{#1}{#2}}

%Stripe
\DeclareMathOperator{\stripea}{s}
\newcommand{\stripe}[2]{\stripea_{{#1}}[{#2}]}
\newcommand{\stripew}[1]{\stripea_{{#1}}}

% compteur pour les proposition, definition etc...
\newcounter{num}
\setcounter{num}{0}
\newcommand{\num}{\stepcounter{num} }
\newcommand{\numl}[1]{\refstepcounter{num}\label{#1}}

%downstep
\newcommand{\dstep}{d}

%upstep
\newcommand{\ustep}{a}

%first
\DeclareMathOperator{\firsta}{L}
\newcommand{\first}[2]{\firsta_{{#1}}({#2})}

\DeclareMathOperator{\firstia}{LI}
\newcommand{\firsti}[2]{\firstia_{{#1}}({#2})}

\DeclareMathOperator{\factora}{F}
\newcommand{\factor}[2]{\factora_{{#1}}({#2})}

%binvincular
\newcommand{\x}{X}
\newcommand{\y}{Y}
\newcommand{\bmotif}{(\sigma,\x,\y)}

\newcommand{\pbmotif}{\pmotif^+}
\newcommand{\pbmotifX}{\x_{\pbmotif}}
\newcommand{\pbmotifY}{\y_{\pbmotif}}

%Pattern Marching
\DeclareMathOperator{\PMa}{PM}
\newcommand{\PM}[6]{\PMa_{{#1}}^{{#2},{#3},{#4}}({#5},{#6})}

\DeclareMathOperator{\lb}{lb}
\DeclareMathOperator{\ub}{ub}

%LM
\DeclareMathOperator{\LMa}{LM}
\newcommand{\LM}[4]{\LMa_{{#1}}^{{#2}}(#3,#4)}

\DeclareMathOperator{\AFa}{AF}
\newcommand{\AF}[4]{\AFa_{{#1}}^{{#2}}(#3,#4)}

\DeclareMathOperator{\DFa}{DF}
\newcommand{\DF}[4]{\DFa_{{#1}}^{{#2}}(#3,#4)}

%LSC
\DeclareMathOperator{\LCSa}{LCS}
\newcommand{\LCS}[8]{\LCSa_{{#1},{#2},{#3}}^{{#4},{#5},{#6}}({#7},{#8})}

\DeclareMathOperator{\matcha}{M}
\newcommand{\match}[8]{\matcha_{{#1},{#2},{#3}}^{{#4},{#5},{#6}}({#7},{#8})}

%SET OF OCCURENCE
\DeclareMathOperator{\SETa}{S}
\newcommand{\SET}[4]{\SETa_{{#1}}^{{#2}}({#3},{#4})}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{Pattern matching for\\ $(213,231)$-avoiding permutations}
\author{Both Emerite NEOU, Romeo RIZZI}
\date{}

\author{%
	Both Emerite Neou\thanks{On a Co-tutelle  Agreement with the Department of Mathematics of the University of Trento}\inst{1}
  Romeo Rizzi\inst{2} \and
  St\'ephane Vialette\inst{1}
}% end author
\institute{%
	Universit\'e Paris-Est, LIGM (UMR 8049), CNRS, UPEM, ESIEE Paris, ENPC,
	F-77454, Marne-la-Vallée, France\\
  \email{\{neou,vialette\}@univ-mY.fr}
  \and
  Department of Computer Science,
  Università degli Studi di Verona, Italy \\
  \email{romeo.rizzi@univr.it}
}% end institute

\date{\today}

\maketitle

\begin{abstract}
	Given permutations $\sigma \in S_k$ and $\pi \in S_n$, the
  \emph{pattern containment} problem is to decide whether $\pi$ contains
  $\sigma$ as an order-isomorphic subsequence.
	We give a linear-time algorithm in case both $\pi$ and $\sigma$ avoid
	the two size-$3$ permutations $213$ and $231$.
	For the special where only $\sigma$ avoids $213$ and $231$, we present a
	$O(kn^2)$ time algorithm. 
	Finally We extend our research to bivincular pattern that avoid $213$ and $231$
	 and present a $O(kn^5)$ time algorithm.
\end{abstract}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}
\label{section:Introduction}

	A permutation $\pi$ is said to contain another permutation $\sigma$,
	in symbols $\sigma \preceq \pi$,
	if there exists a subsequence of entries of $\pi$ that has the same relative
	order as $\sigma$, and in this case $\sigma$ is said to be a
	\emph{pattern} of $\pi$.
	Otherwise, $\pi$ is said to \emph{avoid} the permutation $\sigma$.
	For example a permutation contains the pattern $123$ (resp. $321$) if it has
	an increasing (resp. decreasing) subsequence of length $3$.
	Here, note that members need not actually to be consecutive,
	merely increasing (resp. descreasing).
	As another example,
	$6152347$ contains $213$ but not $231$.
	During the last decade, the study of the pattern containment on permutations has
	become a very active area of research \cite{Kitaev:book:2011} and
	a whole annual conference (\textsc{Permutation Patterns}) is now devoted
	to this topic.

	We consider here the so-called \emph{pattern containment} problem
	(also sometimes referred to as the \emph{pattern involvement problem}):
	Given two permutations $\sigma$ and $\pi$, this problem is to decide whether
	$\sigma \preceq \pi$ (the problem is ascribed to Wilf in \cite{Bose:Buss:Lubiw:1998}).
	The permutation containment problem is known to be \NPhard~\cite{Bose:Buss:Lubiw:1998}.
	It is, however, polynomial-time solvable by brute-force enumeration
	if $\sigma$ has bounded size.
	Improvements to this algorithm were presented in
	\cite{Albert:Aldred:Atkinson:Holton:ISAAC:2001} and
	\cite{Ahal:Rabinovich:2008},
	the latter describing a $O(|\pi|^{0.47|\sigma|+o(|\sigma|)})$ time algorithm.
	Bruner and Lackner \cite{Bruner:Lackner:SWAT:2012}
	gave a fixed-parameter algorithm solving the pattern containment problem with
	an exponential worst-case runtime of $O(1.79^{\RUN(\pi)})$,
	where $\RUN(\pi)$ denotes the number of alternating runs of $\pi$.
	(This is an improvement upon the $O(2^{|\pi|})$ runtime required by
	brute-force search without imposing restrictions on $\sigma$ and $\pi$.)
	A recent major step was taken by􏰂 Marx and Guillemot
	\cite{Guillemot:Marx:SODA:2014}.
	They showed that
	the permutation containment problem is fixed-parameter tractable (FPT) for
	parameter $|\sigma|$.

	A few particular cases of the pattern containment problem have been attacked successfully.
	The case of increasing patterns is solvable in
	$O(|\pi| \log \log |\sigma|)$ time in the RAM model \cite{Crochemore:Porat:2010},
	improving the previous 30-year bound of $O(|\pi| \log |\sigma|)$.
	(The algorithm also improves on the previous
	$O(|\pi| \log \log |\pi|)$ bound.)
	Furthermore, the patterns $132$, $213$, $231$, $312$ can all be handled in linear-time
	by stack sorting algorithms.
	Any pattern of length $4$ can be detected in $O(|\pi| \log |\pi|)$ time
	\cite{Albert:Aldred:Atkinson:Holton:ISAAC:2001}.
	Algorithmic issues for $321$-avoiding patterns containment has been investigated in
	\cite{Guillemot:Vialette:ISAAC:2009}.
	The pattern containment problem is also solvable in
	polynomial-time for separable patterns \cite{Ibarra:1997,Bose:Buss:Lubiw:1998}
	(see also \cite{Bouvel:Rossin:Vialette:CPM:2007} for LCS-like issues
	of separable permutations).
	Separable permutations are those permutations that contain neither
	$2413$ nor $3142$, and they are enumerated by the Schr{\"o}der numbers
	(sequence A006318 in OEIS).
	To the best of our knowledge,
	separable permutations first arose in the work of
	Avis and Newborn~\cite{Avis:Newborn:1981},
	who showed that they are precisely the permutations which can be sorted by an
	arbitrary number of pop-stacks in series,
	where a pop-stack is a restricted form of stack in which any pop operation
	pops all items at once.
	(Notice that the separable permutations include as a special case the
	stack-sortable permutations, which avoid the pattern $231$.)

	There exist many generalisation of patterns that are worth considering
	in the context of algorithmic issues in pattern involvement
	(see \cite{Kitaev:book:2011} for an up-to-date survey).
	\emph{Vincular patterns}, also called
	\emph{generalized patterns},
	resemble (classical) patterns with the additional constraint that some of the letters in
	an occurrence must be consecutive.
	Of particular importance in our context,
	Bruner and Lackner \cite{Bruner:Lackner:SWAT:2012}
	proved that deciding whether a vincular pattern
	$\sigma$ of length $k$ occurs in a longer permutation
	$\pi$ is $W[1]$-complete for
	parameter $k$;
	for an up to date survey of the $W[1]$ class and related material, see
	\cite{Downey:Fellows:2013}.
	\emph{Bivincular patterns} generalize classical patterns even further
	than vincular
	patterns. Indeed, in bivincular patterns,
	not only positions but also values
	of elements involved in a matching may be forced to be adjacent

	We focus in this paper on pattern matching issues for
	$(213,231)$-avoiding permutations
    (\emph{i.e.}, those permutations that avoid both $213$ and $231$).
	The number of $n$-permutations that avoid both
	$213$ and $231$ is
	$t_0 = 1$ for $n = 0$ and
	$t_n =2^{n-1}$ for $n\geq 1$ \cite{Simion:Schmidt:EJC:1985}.
	On an individual basis,
	the permutations that do not contain the permutation pattern $231$
	are exactly the \emph{stack-sortable permutations} and they are counted by
	the Catalan numbers \cite{Knuth:1997:ACP:260999}.
	A stack-sortable permutation is a permutation whose elements may be sorted by
	an algorithm whose internal storage is limited to a single stack data structure.
	As for $213$, it is well-known that
 	if $\pi = \pi_1\pi\,\ldots\,\pi_n$ avoids $132$, then its complement
 	$\pi' = (n+1-\pi_1)(n+1-\pi_2)\,\ldots\,(n+1-\pi_n)$ avoids $312$, and
 	the reverse of $\pi'$ avoids $213$.
 	From a combinatorial point of view,
 	B\'ona \cite{Bona:ElJC:2012}
 	showed the rather surprising fact that the cumulative number of
 	occurrences of the classical patterns $231$ and $213$ are the same on the
 	set of permutations avoiding $132$,
 	beside the pattern based statistics $231$ and $213$
 	do not have the same distribution on this set.
 	\emph{Almost avoidance} has also been considered;
 	a permutation $\pi$ almost avoids a set $X$ of permutations
 	if there is a way to remove a single element of $\pi$ to get a permutation
 	that avoids all elements in $P$
 	and $L_n(P)$ denotes the set of permutations of length $n$ that almost avoid
 	$P$.
 	It is shown in \cite{Griffiths:Smith:Warren:PMA:2011} that
 	$L_n(213, 231) = L_n(132, 231) = L_n(132, 312) = L_n(213, 312)$.

	This paper is organized as follows.
	In Section~\ref{section:Definitions} the needed definition are presented.
	Section~\ref{section:both are (231,213)-avoiding} is devoted to presenting
	an online linear-time algorithm in case both the pattern and the target
	permutation are $(213,231)$-avoiding,
	whereas Section~\ref{section:sigma only avoid 231 and 213} focuses on the case
	where the pattern only is $(213,231)$-avoiding.
	In Section~\ref{section:bivincular} we give a polynomial-time algorithm
	for $(213,231)$-avoiding bivincular patterns.
	In Section~\ref{section:LCS} we consider the problem of finding the longest
	$(213,231)$-avoiding pattern in a permutation.
	In Section~\ref{section:LCS common 2 permutations} we give a
	polynomial-time algorithm for computing the longest
	$(213,231)$-avoiding pattern common to two permutations.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Definitions}
\label{section:Definitions}

A \emph{permutation} of length $n$ is a one-to-one function from an
$n$-element set to itself.
We write permutations as words
$\pi = \pi_1\pi_2\,\ldots\,\pi_n$, whose letters are distinct
and uasually consist of the integers $12\,\ldots\,n$, and we let
$\pi[i]$ stands for $\pi_i$.
For the sake of convenience, we let
$\pi[i:j]$ stand for
$\pi_i\pi_{i+1}\,\ldots\,\pi_j$,
$\pi[:j]$ stand for $\pi[1:j]$ and
$\pi[i:]$ stand for $\pi[i:n]$.
As usual, we let $S_n$ denote the set of all permutations of length $n$.

% The \emph{reduced form} of a permutation $\sigma$ on a set
% $\{j_1, j_2, \ldots, j_k\}$ where
% $j_1 < j_2 < \ldots < j_n$ is the permutation $\sigma'$
% obtained by renaming the letters of $\sigma$ so that
% $j_i$ is renamed $i$ for all $1 \leq i \leq k$.
% We let $\RED(\sigma)$ denote the reduced form of $\sigma$.
% For example $\RED(453) = 231$
% while $\RED(3174) = 2143$.

A permutation $\pi$ is said to \emph{contain} the permutation $\sigma$
if there exists a subsequence of (not necessarily consecutive)
entries of $\pi$ that has the same relative order as $\sigma$,
and in this case $\sigma$ is said to be a \emph{pattern} of
$\pi$, written $\sigma \preceq \pi$.
Otherwise, $\pi$ is said to \emph{avoid} the permutation $\sigma$.
For example, the permutation $\pi = 391867452$
contains the pattern $\sigma = 51342$,
as can be seen in the highlighted subsequence of
$\pi = 3\mathbf{9}\mathbf{1}8\mathbf{6}\mathbf{7}\mathbf{4}52$
(or
$\pi = 3\mathbf{9}\mathbf{1}8\mathbf{6}\mathbf{7}4\mathbf{5}2$
or
$\pi = 3\mathbf{9}\mathbf{1}8\mathbf{6}\mathbf{7}45\mathbf{2}$
).
Each subsequence $91674$,
$91675$,
$91672$ in $\pi$ is called a
\emph{copy},
(or \emph{instance} or \emph{occurrence}) of $\sigma$.
Since the permutation $\pi = 391867452$  contains no increasing subsequence of
length four, $\pi$ avoids $1234$.

Suppose $P$ is a set of permutations. We let $\AV_n(P)$ denote the
set of all $n$-permutations avoiding each permutation in $P$.
For the sake of convenience
(and as it is customary~\cite{Kitaev:book:2011}), we omit $P$'s braces thus having
e.g. $\AV_3(213,231)$ instead of
$\AV_3(\{213,231\})$.
If $\pi \in \AV_n(P)$, we also say that $\pi$ is
\emph{$P$-avoiding}.
% A basic example is if
% $\pi = \pi_1\pi_2\,\ldots\,\pi_n \in \AV_n(321)$, i.e.,
% has no decreasing subsequence of length $3$, then its reverse,
% $\pi' = \pi_n\pi_{n-1}\,\ldots\,\pi_1$ avoids $123$, i.e.,
% has no increasing subsequence of length $3$.

An \emph{ascent} of a permutation $\pi \in S_n$ is any position
$1 \leq i < n$ where the following value is bigger than the current one.
That is, if $\pi = \pi_1\pi_2\,\ldots\,\pi_n$, then
$i$ is an ascent if $\pi_i < \pi_{i+1}$.
For example, the permutation
$345216$7 has ascents (at positions) $1,2,5$ and $6$.
Similarly, a \emph{descent} is a position
$1 \leq i < n$ with $\pi_i > \pi_{i+1}$,
so every $1 \leq i < n$  is either an ascent or is a descent of
$\pi$.
To clarify the exposition,
we let $\ustep$ and $\dstep$ denote an ascend and a descend, respectively.
The \emph{stripe} $s_\pi$ of a permutation $\pi \in S_n$ is the word
$\stripe{\pi}{1} \stripe{\pi}{2} \ldots \stripe{\pi}{n-1} \in \{\ustep,\dstep\}^{n-1}$
defined by
$ \stripe{\pi}{i}= \ustep$ if $i$ an ascent in $\pi$ and
$\stripe{\pi}{i} = \dstep$ if $i$ a descent in $\pi$.
For example the stripe of the permutation
$\pi = 981234765$
is $\stripew{\pi} = \dstep\dstep\ustep\ustep\ustep\ustep\dstep\dstep$.
The stripe $\stripew{\sigma}$ is said to be a \emph{pattern} of the stripe $\stripew{\pi}$
(or $\stripew{\sigma}$ \emph{occurs} of the stripe $\stripew{\pi}$)
if $\stripew{\sigma}$ occurs in $\stripew{\pi}$ as a subsequence.

A \emph{bivincular pattern} (abbreviated BVP) $\sigma$
of length $k$ is a permutation in $S_k$ written in
two-line notation
(that is the top row is $12\,\ldots\,k$ and the bottom row
is a permutation $\sigma_1\sigma_2\,\ldots\,\sigma_k$).
We have the following conditions on the top and bottom rows
of $\sigma$:
\begin{itemize}
	\item
	If the bottom line of $\sigma$ contains
	$\underline{\sigma_i\sigma_{i+1}\,\ldots\,\sigma_j}$
	then the letters corresponding to
	$\sigma_i\sigma_{i+1}\,\ldots\,\sigma_j$ in an occurrence of
	$\sigma$ in a permutation must be adjacent, whereas there is
	no adjacency condition for
	non-underlined consecutive letters.
	Moreover if the bottom row of $\sigma$ begins with
	$_\llcorner{\sigma_1}$ then any occurrence of $\sigma$
	in a permutation $\pi$ must begin with the leftmost
	letter of $\pi$,
	and
	if the bottom row of $\sigma$ begins with
	${\sigma_k}_\lrcorner$ then any occurrence of $\sigma$
	in a permutation $\pi$ must end with the rightmost
	letter of $\pi$.
	\item
	If the top line of $\sigma$ contains
	$\overline{i\,i+1\,\ldots\,j}$ then the letters corresponding to
	$\sigma_i, \sigma_{i+1}, \ldots, \sigma_j$ in an
	occurrence of $\sigma$ in a permutation must be adjacent in values,
	whereas there is no value adjacency restriction for non-overlined
	letters.
	Moreover, if the top row of $\sigma$ begins with
	$^\ulcorner{1}$ then
	any occurrence of $\sigma$ is a permutation $\pi$ must begin with
	the smallest letter of $\pi$, and
	if top row of $\sigma$ ends with $k^\urcorner$ then
	any occurrence of $\sigma$ is a permutation $\pi$ must end with
	the largest letter of $\pi$.
\end{itemize}
For example,
let
$\sigma = \BV{\overline{123}}{\llcorner 213 \lrcorner}$.
If $\pi_i\pi_j\pi_\ell$ is an occurrence of $\sigma$ in $\pi \in S_n$,
then $\pi_i\pi_j\pi_k = (x+1)x(x+2)$ for some $1 \leq x \leq n-2$,
$i=1$ and $\ell = n$.
For example $316524$ contains one occurrence of $\sigma$ (the subsequence $324$),
whereas $42351$ avoids it.
It is straightforward to see that an $n$-permutation
$\pi$ avoids $\BV{\overline{123}}{\llcorner 213 \lrcorner}$ unless
$n \geq 3$,
$\pi_1 = x > 1$
and $\pi_n = x+1$
(in which case there is one occurrence of the pattern).
The best general reference is \cite{Kitaev:book:2011}.

%For algorithmic treatment, it will be convenient to have \ldots
%Given a motif $\pmotif$ we represent the elements underlined by the set $\x$. An index $i$, $1 \leq i < |\sigma|$, of an element is in $\x$ if and only if $i$ and $i+1$ need to be adjacent ($\pmotif[i]$ and $\pmotif[i+1]$ are underlined). We also allow $0$ and $|\sigma|$ to be in the set $\x$ such that if $0 \in \x$ then we have $_\llcorner{\sigma_1}$ and if $|\sigma| \in \x$ then ${\sigma_{|\sigma|}}_\lrcorner$.
%We represent the index that need to be overlined by the set $\y$. An index $i$ is in $\y$ if and only if $i$ and $i+1$ need to be adjacent ($i$ and $i+1$ are overlined). We also allow $0$ and $|\sigma|$ to be in the set $\y$ such that if $0 \in \y$ then we have $^\ulcorner{1}$ and if $|\sigma| \in \y$ then ${|\sigma|}^\urcorner$.

% A bivincular pattern avoids a set of permutations $P$ if its bottom
% row $\sigma_1\sigma_2\,\ldots\,\sigma$ avoids every permutation in $P$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Both $\pi$ and $\sigma$ are $(213,231)$-avoiding}
\label{section:both are (231,213)-avoiding}

This section is devoted to presenting a fast algorithm for deciding if
$\sigma \preceq \pi$
in case both $\pi$ and $\sigma$ are $(213,231)$-avoiding.
We begin with an easy but crucial structure lemma.

\begin{lemma}[Folklore]
\label{lemma:first element is 1 or n}
The first element of any $(213,231)$-avoiding permutation
must be either $1$ or $n$.
\end{lemma}

\begin{proof}
Any other initial element would serve as a `$2$' in either a
$231$ or $213$ with $1$ and $n$ as the `$1$' and `$3$' respectively.
\qed
\end{proof}

Notice that Lemma~\ref{lemma:first element is 1 or n} gives as an
immediate consequence that the number of $(213,231)$-avoiding $n$-permutations
is $2^{n-1}$ for $n\geq 1$ \cite{Simion:Schmidt:EJC:1985}.
The above structural lemma gains in interest in the form of the following corollaries.

\begin{corollary}
\label{corollary:minmaxelement}
$\pi \in \AV_n(213,231)$ if and only if for $1 \leq i \leq n$,
$\pi[i]$ is the minimal or the maximal element of $\pi[i:]$.
\end{corollary}

\begin{corollary}
\label{corollary:max is ascent}
Let $\pi \in \AV_n(213,231)$ and $1 \leq i < n$. Then,
(1) 
if $\pi[i]$ is an ascent element then $\pi[i]$ is the minimal element 
of $\pi[i:]$
and 
(2)
if if $\pi[i]$ is a descent element then $\pi[i]$ is the maximal element 
of $\pi[i:]$
\end{corollary}

%\begin{corollary}
%
%If $\pi \in \Av{n}{(231,213)}$ its stripe can be define such as, \\
%$\stripe{\pi}{i} = \left\{
%	\begin{array}{l l}
%			\ustep & \quad \text{if $\pi[i]$ is the minimal element of $\pi[i:]$}\\
%			\dstep & \quad \text{if $\pi[i]$ is the maximal element of $\pi[i:]$}\\
%\end{array} \right.$
%\end{corollary}

The following lemma is central to all our algorithm.

\begin{lemma}
\label{lemma:MatchStripeToPermutation}
Let $\pi$ and $\sigma$ be two $(213,231)$-avoiding permutations,
and $t$ be a subsequence of $\pi$ of length $|\sigma|$ such that $s_t = s_\sigma$.
Then, $t$ is an occurrence of $\sigma$ in $\pi$ if and only if
$s_t$ occurs as a subsequence in $s_\pi$.
\end{lemma}

\begin{proof}
  The forward direction is obvious.
  We prove the backward direction by induction on the size of the motif
  $\sigma$.
  The base case is a motif of size $2$.
  Suppose first that $\sigma = 12$ and hence $s_\sigma = a$.
  Let $t = \pi_{i_1}\pi_{i_2}$, $i_1 < i_2$, be a subsequence of $\pi$
  such that $s_t$ occurs as a subsequence in $s_\pi$.
  Since $s_\sigma = s_t = a$, this reduces to saying that
  $\pi_{i_1} < \pi_{i_2}$, and hence $t$ is an occurrence of $\sigma = 12$ in $\pi$.
  A similar argument shows that the lemma holds true for $\sigma = 21$.
  Now, assume that the lemma is true for all motifs up to size $k \geq 2$.
  Let $\sigma \in \Av{k+1}{231,213}$ and
  let $t = \pi_{i_1}\pi_{i_2}\,\ldots\,\pi_{i_{k+1}}$,
  $i_1 < i_2 < \ldots < i_{k+1}$,
  be a subsequence of $\pi$ of length $k+1$ such that
  $s_t = s_\sigma$.
  Suppose that $s_t$ occurs in $s_\pi$ as a subsequence.
  Then, $s_t[2:] = s_\sigma[2:]$ occurs as a subsequence in $s_\pi[2:]$.
  But $\sigma[2:] \in \Av{k}{231,213}$ and hence,
  by the inductive hypothesis, it follows that
  $t[2:]$ is an occurrence of $\sigma[2:]$ in $\pi[2:]$.
  Moreover, if $s_\sigma[1] = a$ (resp. $s_\sigma[1] = d$)
  then $\sigma[1]$ is the minimal (resp. maximal) element of $\sigma$
  (Lemma~\ref{lemma:first element is 1 or n}),
  and hence, since $s_t = s_\sigma$ occurs as a subsequence in $s_\pi$,
  $t[1]$ is the minimal (resp. maximal) element of $t$.
  Therefore, $t$ is an occurrence of $\sigma$ in $\pi$.
  \qed
\end{proof}

We are now ready to solve the pattern containment problem in case
both $\pi$ and $\sigma$ are $(213, 231)$-avoiding.

\begin{proposition}
	Let $\pi$ and $\sigma$ be two $(213,231)$-avoiding permutations.
	One can decide whether $\pi$ contains $\sigma$ in linear-time.
\end{proposition}

\begin{proof}
According to Lemma~\ref{lemma:MatchStripeToPermutation} the problem reduces
to deciding whether $s_\sigma$ occurs as a subsequence in $s_\pi$.
A straightforward greedy approach solves this issue in linear-time.
\qed
% To solve the permutation pattern for a permutation in $\AV_n(213,231)$,
% we find a find a match of the stripe of the pattern in the stripe of the text.
% This can be done linearly by a greedy algorithm,
% by matching a step whenever it is possible.
% And thank to the definition of the definition of a stripe in
% Corollary~\ref{corollary:minmaxelement},
% we do not have to compute the stripe in advance.
% Therefore we have an linear (online) algorithm.
\end{proof}

Observe that, according to Corollary~\ref{corollary:minmaxelement},
the effective construction of the two stripes is not required for the above proposition,
and hence we have an online algorithm.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{$\sigma$ only is $(231,213)$-avoiding}
\label{section:sigma only avoid 231 and 213}

This section focuses on the pattern containment problem
in case only the pattern $\sigma$ avoids $231$ and $213$.
We need to consider a specific decomposition $\factora$ of $\sigma$ into factors.
For $\sigma \in S_k$, the \emph{factorization}
$\sigma = \factor{\pmotif}{p} \factor{\pmotif}{p-1} \ldots \factor{\pmotif}{1}$
is defined as follows:
(i) $\sigma[k]$ is the last letter of $\factor{\pmotif}{1}$,
(ii) for every $1 \leq i < k$,
if $s_\sigma[i] = s_\sigma[i+1]$ then
$\sigma[i]\sigma[i+1]$ is part of the same factor.
For every factor $\factor{\pmotif}{j}$ of the decomposition, we let
$\first{\pmotif}{j}$ stand for the leftmost letter of $\factor{\pmotif}{j}$,
and $\firsti{\pmotif}{j}$ stand for the index in $\sigma$
of the leftmost letter of $\factor{\pmotif}{j}$.
For example,
for $\sigma = 981237654$,
we have
$s_\sigma = ddaaaddd$ and hence
$\sigma = \factor{\pmotif}{3} \factor{\pmotif}{2} \factor{\pmotif}{1}$ with
$\factor{\pmotif}{1} =7654$, $\factor{\pmotif}{2} = 123$ and $\factor{\pmotif}{3} = 98$.
Furthermore,
$\first{\pmotif}{1} = 7$, $\first{\pmotif}{2} = 1$, $\first{\pmotif}{3} = 9$,
$\firsti{\pmotif}{1} = 6$, $\firsti{\pmotif}{2} = 3$ and $\firsti{\pmotif}{3} = 1$.

\begin{remark}
A Factor is either an increasing or a decreasing subsequence.
\end{remark}

\begin{lemma}
\label{lemma:whereIsMax}
Given a permutation $\sigma \in \AV(213,231)$ and a suffix of its 
decomposition $\factor{\sigma}{i}\factor{\sigma}{i-1}\ldots\factor{\sigma}{1}$, 
if $\firsti{\sigma}{i}$ is an ascent (resp. descent) element then the maximal 
(resp. minimal) element of $\factor{\sigma}{i}\factor{\sigma}{i-1}\ldots\factor{\sigma}{1}$ is 
$\first{\sigma}{i-1}$.
\end{lemma}

\begin{proof}
Consider the rightmost element of $\factor{\sigma}{i}$ and assume this element is an ascent.
Then, it follows that it is smaller than the following element which is $\first{\sigma}{i-1}$.
Now, since $\factor{\sigma}{i}$ is an increasing subsequence, every element of
$\factor{\sigma}{i}$ is smaller than $\first{\sigma}{i-1}$.
According to Lemma\ref{lemma:first element is 1 or n}, $\first{\sigma}{i-1}$ is the maximal (minimal) element of $\factor{\sigma}{i-1}\ldots\factor{\sigma}{1}$, and hence
$\first{\sigma}{i-1}$ is the maximal  element of
$\factor{\sigma}{i}\factor{\sigma}{i-1}\ldots\factor{\sigma}{1}$.

A similar argument shows that the lemma holds true if the rightmost element
of $\factor{\sigma}{i}$ is a descent.
\qed
\end{proof}

we now define the set
$\SET{\pmotif}{\ptext}{i}{j}$ as follows:
given a subsequence $s$ of $\ptext[j:]$,
$s \in \SET{\pmotif}{\ptext}{i}{j}$ if and only if
$s$ is an occurrence of $\pmotif[\firsti{\pmotif}{i}:]$ in $\ptext[j:]$
and the element$\first{\pmotif}{i}$ occurs in $\ptext[j]$.

\begin{lemma}
Let $\pmotif$ be a permutation 
with $\factor{\pmotif}{i}$ as an ascent (respectively descent) factor,
$s$ a subsequence such that, $s \in \SET{\pmotif}{\ptext}{i}{j}$ and $s[\first{\pmotif}{i-1}]$ is minimal (resp. maximal). 
For all subsequence 
$s' \in \SET{\pmotif}{\ptext}{i}{j}$ and for all subsequence $t$ of $\ptext$, such that $t=t's'$, if $t$ is an occurrence of $\pmotif[\firsti{\pmotif}{i+1}:]$ then the subsequence $t's$ is an occurrence of $\pmotif[\firsti{\pmotif}{i+1}:]$.
\end{lemma}

\begin{proof}
By definition $s$ is an occurrence of $\pmotif[\firsti{\pmotif}{i}:]$. To prove that $ts$ is an occurrence of $\pmotif[\firsti{\pmotif}{i+1}:]$ we prove that every element of t is larger than every element of $s$. If $ts'$ is an occurrence of $\pmotif[\firsti{\pmotif}{i+1}:]$ so every element of $t$ is larger than every element of $s'$. Moreover the maximal element of $s$ is smaller than  the maximal element of $s'$ so every element of $s$ is smaller than every element of $s'$ thus every element of $s$ is smaller than every element of $t$. We use a similar argument if $\factor{\pmotif}{i}$ a descent factor.
\qed
\end{proof}

\begin{corollary}
Let $\pmotif$ be a permutation 
with $\factor{\pmotif}{i}$ as an ascent (respectively descent) factor,
and let $s \in \SET{\pmotif}{\ptext}{i}{j}$, such that $s[\first{\pmotif}{i-1}]$ is minimal (resp. maximal). 
Those following statements are equivalent :
\begin{itemize}
	\item There exists an 
	occurrence of $\pmotif$ in $\ptext$ with element $\first{\pmotif}{i}$ occurs in $\ptext[j]$.
	\item There exists a subsequence $t$ of $\ptext[1:j-1]$  such that $ts$ is an occurrence of $\pmotif$ in $\ptext$ with element $\first{\pmotif}{i}$ occurs in $\ptext[j]$. 
\end{itemize}
\end{corollary}

% This corollary allows us to way to choose a match. Indeed if one does not find a match such that a well chosen subsequence is a suffix of the motif then there is no match at all.

\begin{proposition}
	\label{Proposition:sigma avoids 213 and 231}
	Let $\sigma \in \AV_k(213,231)$ and $\pi \in S_n$.
	One can decide in $O(kn^2)$ time
	and $O(kn^2)$ space if $\pi$ contains $\sigma$.
\end{proposition}

% For the proof and the algorithm we introduce a decomposition : we decompose the stripe of the motif into factor of same letter, and label those factor from right to left. We also need to add the last index into the first factor. For each factor, we denote the left most element by $\firsta$. For example, given the motif $981237654$, $\factor{1} =7654$, $\first{1}=7$, $\factor{2}=123$, $\first{2}=1$, $\factor{3}=98$ and $\first{9}$.

\begin{proof}%[of Proposition~\ref{Proposition:sigma avoids 213 and 231}]
%Given an ascent (descent) factor $\factor{i}$ of a motif $\pmotif$, if we want to match the suffix of $\pmotif$ starting by $\factor{i}$, $\factor{i}\factor{i-1}\cdots\factor{1}$ and given that we know every match of $\factor{i-1}\cdots\factor{1}$, the safest match is to choose the match of $\factor{i-1}\cdots\factor{1}$ that minimize (maximize) the maximal (minimal) element of the match of $\factor{i-1}\cdots\factor{1}$ and that allow a match of factor $\factor{i}$. Indeed when we will match $\factor{i+1}\factor{i}\factor{i-1}\cdots\factor{1}$, every element of $\factor{i+1}$ must be matched to element superior (inferior) to every element matched element of $\factor{i}\factor{i-1}\cdots\factor{1}$, particularly its must be superior (inferior) to the maximal (minimal) element of the match of $\factor{i}\factor{i-1}\cdots\factor{1}$. In other word if we want to match $\pmotif[\first{i}:]$ with $\ptext[j:]$ such that $\first{i}$ is matched with element at index $j$ in $\ptext$, the optimal way of matching $\pmotif[\first{i-1}:]$ is to choose the minimal (maximal) element at index $j'$ of $\ptext[j:]$ such that : (1) $\pmotif[\first{i-1}:]$ is matched with $\ptext[j':]$ and element $\first{i-1}$ is matched with element at index $j'$, (2) the factor $\factor{i}$ is matched with $\ptext[j,j'-1]$ and element $\first{i}$ is matched with element at index $j$, (3) Every elements of the match of (2) if inferior (superior) to the minimal (maximal) element of the match of (1).
%
%\begin{remark}
%Given an ascent (descent) factor $\factor{i}$, the maximal (minimal) element of $\factor{i}\factor{i-1}\cdots\factor{1}$ is $\first{i-1}$.
%\end{remark}
%
%\begin{remark}
%An ascent (descent) factor 	$\factor{i}$ is a match in $\ptext[j:j']$  if and only if there exists an increasing (decreasing) subsequence in $\ptext[j:j']$ of size superior or equal to the size of $\factor{i}$.
%\end{remark}

Consider the following problem :
$$
\LM{\pmotif}{\ptext}{i}{j} =
\begin{cases}

	\text{The maximal value of a subsequence} 
		& \text{If $\first{\sigma}{i}$ is  } \\
	\text{ which is an occurence of $\sigma[\firsti{\sigma}{i}:]$ in $\pi[j:]$} & 
		\text{ an ascent element } \\	
	\text{ and that minimize the maximal value} & \\
	\text{ and $\first{\sigma}{i}$ occurs in $\ptext[j]$} & \\

	&\\

	
	\text{The minimal value of a subsequence} 
		& \text{If $\first{\sigma}{i}$ is  } \\
	\text{ which is an occurence of $\sigma[\firsti{\sigma}{i}:]$ in $\pi[j:]$} & \text{ a descent element } \\	
	\text{ and that maximize the minimal value} & \\
	\text{ and $\first{\sigma}{i}$ occurs in $\ptext[j]$} & \\
\end{cases}
$$

This problem can be solve by induction as follows:

\noindent\textbf{BASE :}
\begin{align*}
\LM{\pmotif}{\ptext}{1}{j} 
&=
\begin{cases}
		\min_{j<j'}\{\infty\} \cup \{\ptext[j'] |\text{ $j'$ such that \indent } 
			& \text{If $\first{\sigma}{i}$ is}  \\
		\text{ $|\factor{\pmotif}{1}| \leq LIS(j,j',\ptext[j'])  $}\}&\text{ an ascent element } \\
		&\\
		\max_{j<j'}\{0\} \cup \{\ptext[j'] |\text{ $j'$ such that \indent } 
			& \text{If $\first{\sigma}{i}$ is}  \\
		\text{ $|\factor{\pmotif}{1}| \leq LDS(j,j',\ptext[j']) $}\}&\text{ a descent element }\\
\end{cases}
\\
\intertext{\textbf{STEP :}}
\LM{\pmotif}{\ptext}{i}{j} 
&=
\begin{cases}
	\min \{\infty\} \cup  \AF{\pmotif}{\ptext}{i}{j} &
	\text{If $\first{\sigma}{i}$ is an ascent element}\\
	\max \{0\} \cup  \DF{\pmotif}{\ptext}{i}{j} &
	\text{If $\first{\sigma}{i}$ is  a descent element}\\
\end{cases}
\end{align*}
where $\AF{\pmotif}{\ptext}{i}{j}$ and $\DF{\pmotif}{\ptext}{i}{j}$ are the sets 
of elements such that if  
$\ptext[k] \in \AF{\pmotif}{\ptext}{i}{j}$ or if $\ptext[k] \in \DF{\pmotif}{\ptext}{i}{j}$ 
then there exists an occurrence of $\pmotif[\firsti{\pmotif}{i}:]$ in $\ptext[j:]$ and the element 
$\first{\pmotif}{i-1}$ occurs in element $\ptext[k]$. 
Given that one has the set $\SET{\pmotif}{\ptext}{i-1}{k}$, 
to decide if $\ptext[k] \in \AF{\pmotif}{\ptext}{i}{j}$, 
one needs to find an occurrence $t$ of $\factor{\pmotif}{i}$ in $\ptext[j:k-1]$ 
such there exists $s \in \SET{\pmotif}{\ptext}{i-1}{k}$ and $ts$ is an occurrence of 
$\pmotif[\firsti{\pmotif}{i}:]$. 
Formally we define $\AF{\pmotif}{\ptext}{i}{j}$ and $\DF{\pmotif}{\ptext}{i}{j}$ as follows:
\begin{align*}
\AF{\pmotif}{\ptext}{i}{j}
&=
\text{$\{\ptext[j'] \;|\; j<j'$ and $\LM{\pmotif}{\ptext}{i-1}{j'} \neq 0$ and} 
\\
&\qquad 
\text{$|\factor{\pmotif}{i}| \leq LIS_{\ptext}(j,j'-1,\first{\pmotif}{i-1})\}$} 
\\
\DF{\pmotif}{\ptext}{i}{j}
&=
\text{$\{\ptext[j'] \;|\; j<j'$ and $\LM{\pmotif}{\ptext}{i-1}{j'} \neq \infty$ and}
\\
&\qquad
\text{$|\factor{\pmotif}{i}| \leq LDS_{\ptext}(j,j'-1,\first{\pmotif}{i-1})\}$}
\end{align*}
where $LIS_{\ptext}(i,j,k)$ (resp. $LDS_{\ptext}(i,j,k)$) is the longest increasing 
(resp. decreasing) sequence in $\ptext$ starting at $i$ and ending at $j$,
with every element of this sequence
smaller (resp. bigger) than $k$.
$LIS_{\ptext}$ and $LDS_{\ptext}$ can be computed in 
$O(|\ptext|^2\log(\log(|\ptext|)))$ (see \cite{Bespamyatnikh00enumeratinglongest}).

For the base case,
one is looking for an occurrence for the first factor.
If the factor is an ascent (respectively descent) factor, then
one has to find an increasing (resp. decreasing) subsequence
in the text of same size or longest that
the size of the first factor.
To find the "safest" solution
one must assure that the right most element
of the sequence is minimal (resp. maximal).\\
For the induction, it follows the same idea
except that one must assure that
every element of the subsequence is larger (resp. smaller)
than the maximal (resp. minimal) element of the rest of the occurrence which is given by the inductive problem of
the previous factor.

There exists a occurrence of $\pmotif$ in $\ptext$ if and only if
there exists a $LM(n,i)\neq 0$ and $LM(n,i)\neq \infty$ for $1 \leq i \leq |\ptext|$,
with $n$ the number of factor in $\pmotif$.
Moreover the basic case can be computed in $O(n^2)$
and the induction on $O(kn^2)$ time and space.
\qed
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{$(213,231)$-avoiding bivincular patterns}
	\label{section:bivincular}

This section is devoted to presenting a polynomial-time algorithm for deciding whether
a $(213,231)$-avoiding bivincular pattern occurs in a permutation.
We start by presenting a property of bivincular motifs avoiding both $213$ and $231$.

\begin{lemma}
\label{lemma:ascentDescentAscent}
If $\overline{\sigma[i]\sigma[j]}$ (thus $\sigma[j]=\sigma[i]+1$) and 
if $\sigma[i]$ is an ascent (respectively decent) element and $\sigma[i]+1$ is an ascent 
(resp. decent) element then 
$i<j$ (resp. $j>i$) and for every $k$, $i<k<j$ (resp. $j>k>i$), $\pi[k]$ is a descent 
(resp. ascent) element.    
\end{lemma}

\begin{proof}
Suppose that there exists $k$, $i<k<j$,
such that $\pmotif[k]$ is ascent. Ascent elements are increasing  so $\sigma[i]<\sigma[k]<\sigma[j]$ which is in contradiction that with $\sigma[j]=\sigma[i]+1$.
We use a similar argument if $\sigma[i]$ is a descent element
\qed
\end{proof}

\begin{proposition}
	\label{Proposition:bivincular pattern}
		Let $\sigma$ be a bivincular motif avoiding $213$ and $231$ of length $k$
		and $\pi \in S_n$.
		One can decide in $O(kn^5)$ time
		and $O(kn^5)$ space if $\sigma$ occurs in $\pi$.
\end{proposition}

\begin{proof}
We consider the following problem :
Given a bivincular motif $\pbmotif$ with $\pmotif \in \Av{n_\pmotif}{231,213} $, and a text $\ptext \in \Av{n_\ptext}{231,213}$.
$$
\PM{\pbmotif}{\ptext}{\lb}{\ub}{i}{j}=
\begin{cases}
	true 	& \text{If $\pbmotif[i:]$ occurs in $\ptext[j:]$}\\
			& \text{with every element is in $[\lb,\ub]$}\\
			& \text{and element $\pmotif[i]$ occurs in $\ptext[j]$ }\\
	false 	& otherwise\\
\end{cases}
$$

$\PM{\pbmotif}{\ptext}{\lb}{\ub}{i}{j}$ is closed under induction.
It can be solved by means by the following relations:

\noindent\textbf{BASE :} \\
$$
\PM{\pbmotif}{\ptext}{\lb}{\ub}{n_\pmotif}{j}=
\begin{cases}
	true 	& \text{if $\ptext[j] \in [\lb,\ub ]$}\\
			& \text{and if ${\pmotif[n_\pmotif]}_\lrcorner$ then $j=n_\ptext$}\\
			& \text{and if ${\pmotif[n_\pmotif]}^\urcorner$ then $\ptext[j]=\ub=n_\pmotif$}\\
			& \text{and if  $^\ulcorner{\pmotif[n_\pmotif]}$ then $\ptext[j]=\lb=1$ } \\
			& \text{and if  $\overline{(\pmotif[n_\pmotif]-1)\pmotif[n_\pmotif] }$ then $\ptext[j]=\lb$ }  \\
			& \text{and if  $\overline{(\pmotif[n_\pmotif]\pmotif[n_\pmotif]-1)}$ then $\ptext[j]=\ub$}  \\

	false	& \text{otherwise} \\
\end{cases}
$$

The base case finds an occurrence for the right most element of the motif. If the last element does not have any restriction on position and on value, then $\PM{\pbmotif}{\ptext}{\lb}{\ub}{n_\pmotif}{j}$ is true if and only if $\pmotif[n_\pmotif]$ can occur in $\ptext[j]$. This condition is checked by assuring that $\ptext[j] \in [\lb,\ub]$. 

\noindent\textbf{STEP :} 

We consider 3 cases for the problem $\PM{\pbmotif}{\ptext}{\lb}{\ub}{i}{j}$ :
\begin{itemize}
	\item If $\ptext[j] \notin [\lb,\ub]$ then :
	$$
	\PM{\pbmotif}{\ptext}{\lb}{\ub}{i}{j} = false
	$$

	this is straightforward with the definition. If $\ptext[j] \notin [\lb,\ub]$ then it can not be part of an occurrence of  $\pmotif[i:]$ in $\ptext[i:]$ with every element is in $[\lb,\ub]$.
	
	\item If $\ptext[j] \in [\lb,\ub]$ and $\pmotif[i]$ is an ascent element then :
	$$
	\PM{\pbmotif}{\ptext}{\lb}{\ub}{i}{j}=
	\begin{cases}
		\bigcup_{j<k} \PM{\pbmotif}{\ptext}{\ptext[j]+1}{\ub}{i+1}{k}
			& \text{if $\pmotif[i]$ is not underlined } \\
			& \text{ and $\pmotif[i]$ is not overlined} \\
		\bigcup_{j<k} \PM{\pbmotif}{\ptext}{\ptext[j]+1}{\ub}{i+1}{k}
			& \text{if $\pmotif[i]$ is not underlined } \\
			& \text{ and $\overline{(\pmotif[i]-1)\pmotif[i]}$ or $^\ulcorner{\pmotif[i]}$}\\
			& \text{ and $\ptext[j]=\lb$} \\
		\PM{\pbmotif}{\ptext}{\ptext[j]+1}{\ub}{i+1}{j+1}
			& \text{if $\underline{\pmotif[i]\pmotif[i+1]}$ } \\
			& \text{ and $\overline{(\pmotif[i]-1)\pmotif[i]}$ or $^\ulcorner{\pmotif[i]}$}\\
			& \text{ and $\ptext[j]=\lb$} \\
		\PM{\pbmotif}{\ptext}{\ptext[j]+1}{\ub}{i+1}{j+1}
			& \text{if $\underline{\pmotif[i]\pmotif[i+1]}$ } \\
			& \text{ and $\pmotif[i]$ is not overlined} \\
		false & \text{otherwise}

	\end{cases}
	$$	
	Remark that $\pmotif[i]$ can occur in $\ptext[j]$ because $\ptext[j] \in [\lb,\ub]$.
	Thus if $\pmotif[i+1:]$ occurs in $\ptext[j+1:]$ with every element in $[\pmotif[i]+1,\ub]$ then 
 	$\pmotif[i:]$ occurs in $\ptext[j:]$  	
 	which correspond to know if there exists $k$, $j<k$ such that
	$\PM{\pbmotif}{\ptext}{\ptext[j]+1}{\ub}{i+1}{k}$ is true.

	
	\item If $\ptext[j] \in [\lb,\ub]$ and $\pmotif[i]$ is a descent element then :

	$$
	\PM{\pbmotif}{\ptext}{\lb}{\ub}{i}{j}=
	\begin{cases}
			\bigcup_{j<k} \PM{\pbmotif}{\ptext}{\lb}{\ptext[j]-1}{i+1}{k}
				& \text{if $\pmotif[i]$ is not underlined } \\
				& \text{ and $\pmotif[i]$ is not overlined} \\
			\bigcup_{j<k} \PM{\pbmotif}{\ptext}{\lb}{\ptext[j]-1}{i+1}{k}
				& \text{if $\pmotif[i]$ is not underlined } \\
				& \text{ and $\overline{\pmotif[i](\pmotif[i]+1)}$ or ${\pmotif[i]}^\urcorner$}\\
				& \text{ and $\ptext[j]=\ub$} \\
			\PM{\pbmotif}{\ptext}{\lb}{\ptext[j]-1}{i+1}{j+1}
				& \text{if $\underline{\pmotif[i]\pmotif[i+1]}$ } \\
				& \text{ and $\overline{\pmotif[i](\pmotif[i]+1)}$ or ${\pmotif[i]}^\urcorner$}\\
				& \text{ and $\ptext[j]=\ub$} \\
			\PM{\pbmotif}{\ptext}{\lb}{\ptext[j]-1}{i+1}{j+1}
				& \text{if $\underline{\pmotif[i]\pmotif[i+1]}$ } \\
				& \text{ and $\pmotif[i]$ is not overlined} \\
			false & \text{otherwise}
	\end{cases}
	$$	
	We can show symmetrically as the last case that 
	$\pmotif[i:]$ occurs in $\ptext[j:]$
	with $\sigma[i]$ occurs in $\pi[j]$.
	 starting at element $j$ if and only if $\bigcup_{j<k} \PM{\pbmotif}{\ptext}{\lb}{\ptext[j]-1}{i+1}{k}$. 

\end{itemize}

Clearly if $\bigcup_{0<j} \PM{\pbmotif}{\ptext}{1}{n_\ptext}{1}{j}$ is true then $\sigma$ occurs in $\pi$. We now discuss about the position and value constraints.
\paragraph{Position Constraint.} There are 3 types of position constraints 
\begin{itemize}
	\item If $_\llcorner{\sigma[1]}$ then the left most element of $\sigma$  must occur in the left most element of $\pi$ ($\pmotif[1]$ occurs in $\ptext[1]$ on an occurrence of $\pmotif$ in $\ptext$). This constraint is assured by demanding that the occurrence starts at the left most element of $\ptext$ : if  $\PM{\pbmotif}{\ptext}{1}{n_\ptext}{1}{1}$ is true.
	
	\item If ${\pmotif[n_\pmotif]}_\lrcorner$ then the right most element $\sigma$ must occurs in the right most element of $\pi$ ($\pmotif[n_\pmotif]$ occurs in $\ptext[n_\ptext]$ on a occurrence of $\pmotif$ in $\ptext$). This constraint is assured in the base case.

	\item If $\underline{\pmotif[i]\pmotif[i+1]}$ then the index of the occurrence of $\pmotif[i]$ and $\pmotif[i+1]$ must be consecutive. In other word if $\pmotif[i]$ occurs in $\ptext[j]$ then $\pmotif[i+1]$ must occur in $\ptext[j+1]$. We assure this restriction in the induction by demanding that occurrences of $\pmotif[i+1:]$  start at index $j+1$.
\end{itemize}

\paragraph{Value Constraint.} There are 3 types of position constraints
\begin{itemize}
	\item If $^\ulcorner{\sigma[i]}$ (and thus $\sigma[i]=1$) then the minimal value of $\pmotif$ must occur in the minimal value of $\ptext$.
	\begin{itemize}

		\item If $\sigma[i]$ is an ascent element then $\sigma[i]$ is the left most ascent element (if not $\sigma[i]$ would not be the minimal element, because ascent elements are increasing). Remark that the problem starts with the lower bound as $1$, and inductive problems before the index $i$ are called with descent elements which do not modified the lower bound, so for every problem with index $i$ has for lower bound $1$. 
		$\PM{\pbmotif}{\ptext}{1}{*}{i}{*}$ is either an inductive case or a base case, in either way  $\PM{\pbmotif}{\ptext}{1}{*}{i}{*}$ is true if and only if the occurrence of $\sigma[i]$ is equal to lower bound which is  $1$.	
				
		\item If $\sigma[i]$ is a descent element then $i=n_\pmotif$ ($\sigma[i]$ is the right most element). Which is solved in the case case.

	\end{itemize}




	\item If ${\pmotif[i]}^\urcorner$ (and thus $\sigma[i]=n_\pmotif$) then the maximal value of $\pmotif$ must occur in the maximal value of $\ptext$.
	\begin{itemize}

		\item If $\sigma[i]$ is a descent element then $\sigma[i]$ is the left most ascent element (if not $\sigma[i]$ would not be the maximal element, because descent elements are decreasing). Remark that the problem starts with the upper bound as $n_\ptext$, and any inductive problems before the index $i$ are called with ascent elements which do not modified the upper bound, every problem with index $i$ has for upper bound $n_\ptext$. 		$\PM{\pbmotif}{\ptext}{*}{n_\pmotif}{i}{*}$ is either an inductive case or a base case, in either way  $\PM{\pbmotif}{\ptext}{*}{n_\pmotif}{i}{*}$ is true if and only if the occurrence of $\sigma[i]$ is equal to upper bound which is  $n_\pmotif$.
		
		
		\item If $\sigma[i]$ is an ascent element then $\sigma[i]$ then $i=n_\pmotif$ ($\sigma[i]$ is the right most element) which is solved in the base case.

	\end{itemize}



	\item  If $\overline{\pmotif[i]\pmotif[i']}$, with $\pmotif[i']=\pmotif[i]+1$ then if $\pmotif[i]$ occurs in $\ptext[j]$ then $\pmotif[i']$ must occur in $\ptext[j]+1$.
		\begin{itemize}

			\item The case $\pmotif[i]$ is a descent element, $\pmotif[i']$ is an ascent element and $i<i'$ (remark that this case is equivalent to the case $\pmotif[i]$ is an ascent element, $\pmotif[i']$ is a descent element and $i'<i$) is not possible. 
			Indeed $\pmotif[i]$ is the maximal element of $\pmotif[i:]$ thus $\pmotif[i] > \pmotif[i']$ which is in contradiction with 
			$\pmotif[i']=\pmotif[i]+1$. 
			
			\item If $\pmotif[i]$ is an ascent element, $\pmotif[i']$ is a descent element and $i<i'$ (remark that this case is equivalent to the case $\pmotif[i]$ is a descent element, $\pmotif[i']$ is an ascent element and $i'<i$) , then
			$\pmotif[i]$ is the right most ascent element and $\pmotif[i']$ is the right most element (or $\pmotif[i'] \neq \pmotif[i]+1$). Thus inductive problems between $i+1$ and $i'$ do not modified the lower bound. If $\sigma[i]$ occurs in $\ptext[j]$ then the inductive problems after $\PM{\pbmotif}{\ptext}{*}{*}{i}{*}$ have for lower bound $\ptext[i]+1$. The problem $\PM{\pbmotif}{\ptext}{*}{*}{i'}{*}$ is a base case and is true if and only if
			the occurrence of $\sigma[i']$ is equal the lower bound which is equal to $\ptext[i]+1$ so the occurrence of $\pmotif[i]$ and $\pmotif[i']$ are consecutive in value.
				
			\item If $\pmotif[i]$ is a descent element and $\pmotif[i']$ is a descent element then $i'<i$ and there is no descent element between $\pmotif[i]$ and $\pmotif[i']$ (lemma \ref{lemma:ascentDescentAscent}), Thus inductive problems between $i'+1$ and $i$ do not modified the upper bound. Remark that if $\pmotif[i']$ occurs in $\ptext[j]$ then 
			the inductive problems after $\PM{\pbmotif}{\ptext}{*}{*}{i'}{*}$ have for upper bound $\ptext[j]-1$. $\PM{\pbmotif}{\ptext}{*}{*}{i}{*}$ is either an inductive case or a base case, in either way  $\PM{\pbmotif}{\ptext}{*}{*}{i}{*}$ is true if and only if the occurrence of $\sigma[i]$ is equal to upper bound which is equal to $\sigma[i']-1$ so the occurrence of $\pmotif[i]$ and $\pmotif[i']$ are consecutive in value.
			
			\item If $\pmotif[i]$ is an ascent element and $\pmotif[i']$ is an ascent element then $i<i'$ and there is no  ascent element between $\pmotif[i]$ and $\pmotif[i']$ (lemma \ref{lemma:ascentDescentAscent}), Thus inductive problems between $i+1$ and $i'$ do not modified the lower bound. Remark that if $\pmotif[i]$ occurs in $\ptext[j]$ then 

			the inductive problems after $\PM{\pbmotif}{\ptext}{*}{*}{i}{*}$ have for lower bound $\ptext[j]+1$. $\PM{\pbmotif}{\ptext}{*}{*}{i'}{*}$ is either an inductive case or a base case, in either way  $\PM{\pbmotif}{\ptext}{*}{*}{i'}{*}$ is true if and only if the occurrence of $\sigma[i']$ is equal to lower bound which is equal to $\sigma[i']+1$ so the occurrence of $\pmotif[i]$ and $\pmotif[i']$ are consecutive in value.
		\end{itemize}
\end{itemize}
\qed
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Computing the longest $(213,231)$-avoiding subsequence}
\label{section:LCS}

	This section is devoted to finding longest $(213,231)$-avoiding subsequences in permutations:
	Given a set of permutations, find a longest $(213,231)$-avoiding that occurs as a pattern
	in each input permutation.

	We start with the easiest case where we are given just one input permutation.
	We need the set of descent elements and the set of ascent elements.
	$P(\pi) = \{i | \stripe{\pi}{i} = \ustep \} \cup \{n\}$ and
	$M(\pi) = \{i | \stripe{\pi}{i} = \dstep \} \cup \{n\}$.\\

	\begin{proposition}
	\label{proposition:longestIncreasingSubsequence}
	If $s$ is a longest $(213,231)$-avoiding subsequence with last element at index 
	$f$ in $\pi$ then
	$P(\pi)$ is a longest increasing subsequence with last element at index $f$ and
	$M(\pi)$ is a longest decreasing subsequence with last element at index $f$.
	\end{proposition}

	\begin{proof}
	Let $s$ be a longest subsequence avoiding (213,231) with last element at index $f$ in $\pi$,
	suppose that $P(\pi)$ is not a longest increasing subsequence with last element at index $f$. Let $s_m$ be a longest increasing subsequence with last element $f$.
	Thus $|s_m|>|P(\pi)|$, clearly the sequence $s_m \cup M(\pi)$
	is $(213,231)$-avoiding and is longer than $s$, this is a contradiction.
	The same ideacan be used to show that $M(\pi)$ is the longest decreasing subsequence.
	\qed
	\end{proof}

	\begin{proposition}
	Let $\pi$ be a permutation. One can compute the
	the longest $(213,231)$-pattern that occurs in $\pi$
	in $O(|\ptext|\log(\log(|\ptext|)))$ time and in $O(n)$ space.
	\end{proposition}

	\begin{proof}
	The proposition \ref{proposition:longestIncreasingSubsequence} lead to an algorithm
	where one has to compute longest increasing and decreasing subsequence ending at every index. Then finding the maximal sum of longest increasing and decreasing subsequence ending at the same index.
	Computing the longest increasing subsequence and the longest decreasing subsequence can be done in 
	$O(|\ptext|\log(\log(|\ptext|)))$ time and $O(n)$ space 
	(see \cite{Bespamyatnikh00enumeratinglongest}), 
	then finding the maximal can be done in linear time.
	\qed
	\end{proof}

We now turn to considering the case where the input is composed of two permutations.

\begin{proposition}
Given two permutations $\pi_1$ and $\pi_2$,
one can compute 
the longest common subsequence
avoiding (231,213) in $O(|\pi_1|^3|\pi_2|^3)$ time and space.
\end{proposition}

\begin{proof}
Consider the following problem,
that compute the longest stripe common to $\pi_1$ and $\pi_2$.
Given two permutations $\pi_1$ and $\pi_2$.\\

$$
\LCS{\pi_1}{\lb_1}{\ub_1}{\pi_2}{\lb_2}{\ub_2}{i_1}{i_2}
$$
\begin{center}
= $\max$ \{$|s|$ $|$ $s$ occurs in $\pi_1[i_1:]$ with every element is in $[\lb_1,\ub_1]$ and $s$ occurs in $\pi_2[i_2:]$ with every element is in $[\lb_2,\ub_2]$ \}
\end{center}



We show that this family of problems are closed under induction.\\


\noindent\textbf{BASE :}

$$
\LCS{\pi_1}{\lb_1}{\ub_1}{\pi_2}{\lb_2}{\ub_2}{|\pi_1|}{|\pi_2|} =
\begin{cases}
	1 & \text{if $\lb_1 \leq \pi_1[j] \leq \ub_1$
	}\\
	& \text{ and $\lb_2 \leq \pi_2[j] \leq \ub_2$}\\
	0 & otherwise\\
\end{cases}
$$

\noindent\textbf{STEP :}

$$
\LCS{\pi_1}{\lb_1}{\ub_1}{\pi_2}{\lb_2}{\ub_2}{i_1}{i_2}=max
\begin{cases}
	\LCS{\pi_1}{\lb_1}{\ub_1}{\pi_2}{\lb_2}{\ub_2}{i_1}{i_2+1} \\
	\\
	\LCS{\pi_1}{\lb_1}{\ub_1}{\pi_2}{\lb_2}{\ub_2}{i_1+1}{i_2} \\
	\\
	\match{\pi_1}{\lb_1}{\ub_1}{\pi_2}{\lb_2}{\ub_2}{i_1}{i_2}
\end{cases}
$$

with \\
$
\match{\pi_1}{\lb_1}{\ub_1}{\pi_2}{\lb_2}{\ub_2}{i_1}{i_2}=
\begin{cases}
1+\LCS{\pi_1}{\pi_1[i_1]+1}{\ub_1}{\pi_2}{\pi_2[i_2]+1}{\ub_2}{i_1}{i_2+1}
	& \text{$\pi_1[i_1]<\lb_1$ } \\
	& \text{and $\pi_2[i_2]<\lb_2$} \\

&\\

1+\LCS{\pi_1}{\lb_1}{\pi_1[i_1]-1}{\pi_2}{\lb_2}{\pi_2[i_2]-1}{i_1+1}{i_2}
	& \text{$\pi_1[i_1]>\ub_1$ } \\
	&\text{and $\pi_2[i_2]>\ub_2$}\\

&\\

0 	& \text{otherwise}\\
\end{cases}
$


For every pair $i,j$ we either ignore the element of $\pi_1$,
ot we ignore the element of $\pi_2$,
or we match as the same step (if possible).
Those relations lead to a $O(|\pi_1|^3|\pi_2|^3)$ time and $O(|\pi_1|^3|\pi_2|^3)$ space algorithm.
$\qed$
\end{proof}


\bibliography{bibli}{}
\bibliographystyle{plain}


\end{document}
